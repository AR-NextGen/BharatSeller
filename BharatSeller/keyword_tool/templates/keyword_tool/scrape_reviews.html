{% extends 'keyword_tool/base.html' %}

{% block content %}
<h1>Scrape Amazon Reviews</h1>
<form method="post" id="scrape-reviews-form">
    {% csrf_token %}
    <div class="form-group">
        <label for="product_url">Product URL</label>
        <input type="text" name="product_url" id="product_url" class="form-control" placeholder="Enter Amazon product URL">
    </div>
    <button type="submit" class="btn btn-primary">Scrape Reviews</button>
</form>

<div id="reviews-results">
    <!-- Reviews and sentiments will be displayed here -->
</div>

<script>
    document.getElementById('scrape-reviews-form').onsubmit = function(event) {
        event.preventDefault();
        const formData = new FormData(this);
        fetch("{% url 'scrape_reviews' %}", {
            method: 'POST',
            body: formData,
            headers: {
                'X-Requested-With': 'XMLHttpRequest',
            },
        })
        .then(response => response.json())
        .then(data => {
            const resultsDiv = document.getElementById('reviews-results');
            let resultsHtml = '<h2>Scraped Reviews</h2><ul>';
            data.reviews.forEach((review, index) => {
                resultsHtml += `<li>${review} - Sentiment: ${data.sentiments[index]}</li>`;
            });
            resultsHtml += '</ul>';
            resultsDiv.innerHTML = resultsHtml;
        })
        .catch(error => console.error('Error:', error));
    };
</script>
{% endblock %}